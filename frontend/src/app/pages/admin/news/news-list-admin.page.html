<!-- Shell de administración con sidebar -->
<div class="ds-admin-shell">

  <!-- Sidebar contextual -->
  <app-admin-sidebar-container />

  <!-- Contenido principal -->
  <main class="ds-admin-main ds-container">

    <!-- Cabecera: título + subtítulo de scope + botón crear -->
    <div class="flex items-start justify-between gap-4 py-6">
      <div>
        <h2 class="h2">Noticias</h2>
        <app-admin-page-subtitle />
      </div>
      <button class="ds-btn ds-btn-primary mt-1" (click)="onNuevaNoticia()">
        + Nueva noticia
      </button>
    </div>

    <!-- Estado: cargando -->
    @if (isLoading()) {
      <p class="text-neutral-dark py-8 text-center">Cargando noticias...</p>
    }

    <!-- Estado: error -->
    @else if (errorMessage()) {
      <div class="ds-alert ds-alert-error">{{ errorMessage() }}</div>
    }

    <!-- Estado: sin resultados -->
    @else if (tableRows().length === 0) {
      <p class="text-neutral-dark py-8 text-center">No hay noticias en este ámbito.</p>
    }

    <!-- Tabla de noticias -->
    @else {
      <div class="ds-table-card" style="height: calc(100vh - 14rem);">
        <app-admin-table
          [columns]="columns"
          [data]="tableRows()"
          [actions]="tableActions"
          (rowClick)="onRowClick($event)"
          (action)="onTableAction($event)"
        />
      </div>
    }

  </main>
</div>

<!-- Modal de previsualización -->
@if (showPreviewModal()) {
  <div class="ds-modal-backdrop" (click)="onClosePreview()">
    <div class="ds-modal-content" style="max-width: 1400px" (click)="$event.stopPropagation()">

      <!-- Cabecera del modal -->
      <div class="flex items-center justify-between gap-4 px-6 py-4 border-b border-neutral-medium">
        <h3 class="h3 truncate">{{ selectedNews()?.title ?? 'Noticia' }}</h3>
        <button
          class="ds-btn ds-btn-secondary"
          (click)="onClosePreview()"
          aria-label="Cerrar previsualización">
          ✕
        </button>
      </div>

      <!-- Cuerpo del modal -->
      <div class="px-6 py-6">
        @if (isLoadingPreview()) {
          <p class="text-center text-neutral-dark py-10">Cargando contenido...</p>
        } @else if ((selectedNews()?.content?.segments?.length ?? 0) === 0) {
          <p class="text-center text-neutral-dark py-10 italic">Esta noticia no tiene contenido html.</p>
        } @else {
          <app-content-renderer [content]="selectedNews()!.content" />
        }
      </div>

    </div>
  </div>
}
