<!-- Template: Selector de juegos -->
<ng-template #gamesSelector let-id="id" let-cssClass="cssClass" let-onChange="onChange">
  <label class="sr-only" [attr.for]="id">Seleccionar juego</label>
  <select
    [id]="id"
    [value]="gamesStore.selectedGameId() ?? ''"
    (change)="onChange($event)"
    [class]="cssClass"
  >
    <option value="" [selected]="!gamesStore.selectedGameId()">Todos los juegos</option>
    @for (g of gamesStore.sortedGames(); track g.id) {
      <option [value]="g.id" [selected]="gamesStore.selectedGameId() === g.id">{{ g.name }}</option>
    }
  </select>
</ng-template>

<!-- Template: Nav items -->
<ng-template #navItemsList let-cssClass="cssClass" let-onNavigate="onNavigate">
  @for (item of navItems(); track item.label) {
    @if (!item.condition || item.condition()) {
      @if (item.type === 'link') {
        <a [routerLink]="item.route" [class]="cssClass" (click)="onNavigate()">{{ item.label }}</a>
      } @else {
        <button type="button" [class]="cssClass" [class.text-left]="cssClass === 'ds-nav-mobile-link'" (click)="item.onClick?.(); onNavigate()" [attr.aria-label]="item.label === '?' ? 'Ayuda' : undefined">{{ item.label }}</button>
      }
    }
  }
</ng-template>

<nav class="ds-nav" aria-label="Navegación principal">
  <div class="ds-nav-inner">
    <!-- Brand / Logo -->
    <a routerLink="/" class="ds-nav-brand">Naipeando</a>

    <!-- Enlaces / controles desktop -->
    <div class="ds-nav-links">
      <!-- Selector de juegos (desktop) -->
      <ng-container *ngTemplateOutlet="gamesSelector; context: {id: 'desktop-games', cssClass: 'ds-nav-link', onChange: onDesktopGameChange.bind(this)}"></ng-container>

      <!-- Nav items desktop -->
      <ng-container *ngTemplateOutlet="navItemsList; context: {cssClass: 'ds-nav-link', onNavigate: noop.bind(this)}"></ng-container>
    </div>

    <!-- Acciones -->
    <div class="ds-nav-actions">
      <!-- Menú de usuario (desktop) -->
      <app-user-menu variant="desktop"></app-user-menu>

      <!-- Botón hamburguesa (mobile) -->
      <button
        type="button"
        class="ds-nav-toggle"
        aria-label="Menú"
        [attr.aria-expanded]="mobileMenuOpen()"
        (click)="toggleMobileMenu()"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Panel de menú móvil -->
  @if (mobileMenuOpen()) {
    <div class="ds-nav-mobile">
      <div class="ds-nav-mobile-list">
        <!-- Selector de juegos (mobile) -->
        <div class="border-b border-neutral-medium">
          <ng-container *ngTemplateOutlet="gamesSelector; context: {id: 'mobile-games-select', cssClass: 'ds-nav-mobile-link w-full border-0', onChange: onMobileGameChange.bind(this)}"></ng-container>
        </div>

        <!-- Nav items mobile -->
        <ng-container *ngTemplateOutlet="navItemsList; context: {cssClass: 'ds-nav-mobile-link', onNavigate: closeMobileMenu.bind(this)}"></ng-container>
      </div>
    </div>
  }
</nav>

<app-help-panel [isOpen]="helpOpen()" (close)="closeHelp()" />
