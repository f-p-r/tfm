<main class="ds-main">
  <div class="ds-page">
    <div class="ds-container space-y-6">
      <header class="border-b border-neutral-medium pb-4">
        <p class="text-xs uppercase tracking-[0.18em] text-neutral-dark/70">Prototipo</p>
        <h1 class="h1 mt-2">TinyMCE Editor</h1>
        <p class="p mt-2 text-neutral-dark/80">
          Editor de segmentos usando TinyMCE en lugar de Quill
        </p>
      </header>

      <section>
        <div class="flex flex-wrap items-center gap-3">
          <button 
            type="button" 
            (click)="addRichSegment()" 
            class="ds-btn ds-btn-primary"
          >
            Añadir segmento texto
          </button>
          <button 
            type="button" 
            (click)="addCarouselSegment()" 
            class="ds-btn ds-btn-primary"
          >
            Añadir carrusel
          </button>
        </div>
      </section>

      <section class="grid gap-4">
        @for (segment of segments(); track segment.id) {
          <article class="border border-neutral-medium rounded-lg p-4 bg-white shadow-sm">
            <div class="flex flex-wrap items-center gap-2 justify-between mb-4">
              <div class="font-display font-semibold text-brand-primary">
                #{{ segment.order }} · 
                @if (segment.type === 'rich') {
                  Texto
                } @else {
                  Carrusel
                }
              </div>
              
              @if (editingId() === segment.id) {
                <div class="flex flex-wrap items-center gap-2">
                  <button 
                    type="button" 
                    class="ds-btn ds-btn-primary" 
                    (click)="saveEdit()"
                  >
                    Guardar
                  </button>
                  <button 
                    type="button" 
                    class="ds-btn ds-btn-secondary" 
                    (click)="discardEdit()"
                  >
                    Descartar
                  </button>
                </div>
              } @else {
                <div class="flex flex-wrap items-center gap-2">
                  <button 
                    type="button" 
                    class="ds-btn ds-btn-secondary" 
                    (click)="moveUp(segment.id)"
                  >
                    ↑
                  </button>
                  <button 
                    type="button" 
                    class="ds-btn ds-btn-secondary" 
                    (click)="moveDown(segment.id)"
                  >
                    ↓
                  </button>
                  <button 
                    type="button" 
                    class="ds-btn ds-btn-secondary" 
                    (click)="startEdit(segment.id)"
                  >
                    Editar
                  </button>
                  <button 
                    type="button" 
                    class="px-3 py-1.5 rounded-lg border border-red-200 text-red-700 hover:bg-red-50 transition" 
                    (click)="remove(segment.id)"
                  >
                    Eliminar
                  </button>
                </div>
              }
            </div>

            @if (editingId() === segment.id) {
              @if (segment.type === 'rich') {
                <div class="tinymce-wrapper">
                  <editor
                    [init]="init"
                    [formControl]="editorControl"
                  ></editor>
                </div>
              } @else if (segment.type === 'carousel') {
                <div class="space-y-4">
                  <div>
                    <button 
                      type="button" 
                      class="ds-btn ds-btn-secondary" 
                      (click)="addImage(segment.id)"
                    >
                      Añadir imagen
                    </button>
                  </div>

                  @if (segment.images && segment.images.length > 0) {
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                      @for (img of segment.images; track $index) {
                        <div class="border border-neutral-medium rounded-lg overflow-hidden bg-white">
                          <img 
                            [src]="img" 
                            alt="Imagen {{ $index + 1 }}" 
                            class="w-full h-32 object-cover"
                          />
                          <div class="p-2">
                            <button 
                              type="button" 
                              class="text-xs text-red-700 hover:text-red-500" 
                              (click)="removeImage(segment.id, $index)"
                            >
                              Eliminar
                            </button>
                          </div>
                        </div>
                      }
                    </div>
                  } @else {
                    <p class="text-sm text-neutral-dark/60">No hay imágenes</p>
                  }
                </div>
              }
            } @else {
              @if (segment.type === 'rich' && segment.content) {
                <div class="prose max-w-none" [innerHTML]="segment.content"></div>
              } @else if (segment.type === 'carousel') {
                <p class="text-sm text-neutral-dark/60">
                  Carrusel con {{ segment.images?.length || 0 }} imagen(es)
                </p>
              }
            }
          </article>
        }

        @if (segments().length === 0) {
          <div class="text-center py-12 text-neutral-dark/60">
            <p>No hay segmentos. Añade uno para comenzar.</p>
          </div>
        }
      </section>
    </div>
  </div>
</main>
